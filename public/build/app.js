// Generated by CoffeeScript 1.3.3
(function(){define("app",[],function(){var a;return a={}})}).call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/owner",[],function(){var a;return a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.idAttribute="_id",c.prototype.urlRoot="/api/owners",c}(Backbone.Model)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/subnavcards_view",["app","models/owner"],function(b,d){var e;return e=function(e){function f(){return this.sharedCard=a(this.sharedCard,this),this.cardShare=a(this.cardShare,this),this.edit=a(this.edit,this),this.card=a(this.card,this),this.render=a(this.render,this),f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.id="js-subnavcards",f.prototype.template=jade.templates.subnavcards,f.prototype.events={"click .js-cards a":"routerFollow","click .js-new a":"routerFollow","click .js-share a":"routerFollow","click .js-card a":"routerFollow","click .js-edit a":"routerFollow","click .js-card-share a":"routerFollow","click .js-shared a":"routerFollow","click .js-shared-card a":"routerFollow","click .js-refresh a":"refresh","click .js-delete a":"destroy"},f.prototype.initialize=function(){var a;this.data={authenticated:null,card:null,owner:null},this.data.toJSON=function(){var a,c,d;return a={},a.authenticated=b.session.authenticated,a.card=(c=this.card)!=null?c.toJSON():void 0,a.owner=(d=this.owner)!=null?d.toJSON():void 0,a},b.owner=b.owner||new d,b.dispatcher.on("card:ready",this.card),b.dispatcher.on("card:edit:ready",this.edit),b.dispatcher.on("card:share:ready",this.cardShare),b.dispatcher.on("shared:card:ready",this.sharedCard),a=$("#owner-json").remove().text();if(a)return b.owner.set(JSON.parse(a))},f.prototype.render=function(){return this.$el.html(this.template(this.data.toJSON())),this},f.prototype.routerFollow=function(a){return b.router.follow(a)},f.prototype.activateLink=function(a){return this.$("li").each(function(a,b){return $(b).removeClass("active")}),this.$(a).addClass("active")},f.prototype.confirmDelete=function(){var a;return a=this.$(".js-delete a"),a.hasClass("js-confirm-delete")?(a.removeClass("js-confirm-delete"),a.text("Delete"),!0):(a.addClass("js-confirm-delete"),a.text("Delete?"),!1)},f.prototype.refresh=function(a){return a.preventDefault(),b.dispatcher.trigger("content:refresh")},f.prototype.destroy=function(a){var c;a.preventDefault();if(this.confirmDelete())return c=b.card,b.demo.active?b.demo.destroy(c):c.destroy(),b.router.navigate("cards",{trigger:!0}),$(window).scrollTop(0)},f.prototype.cards=function(){return this.data.card=null,this.data.owner=null,this.render(),this.activateLink(".js-cards"),this},f.prototype["new"]=function(){return this.data.card=null,this.data.owner=null,this.render(),this.activateLink(".js-new"),this},f.prototype.share=function(){return this.data.card=null,this.data.owner=null,this.render(),this.activateLink(".js-share"),this},f.prototype.card=function(){return this.data.card=b.card,this.data.owner=null,this.render(),this.activateLink(".js-card"),this},f.prototype.edit=function(){return this.data.card=b.card,this.data.owner=null,this.render(),this.activateLink(".js-edit"),this},f.prototype.cardShare=function(){return this.data.card=b.card,this.data.owner=null,this.render(),this.activateLink(".js-card-share"),this},f.prototype.shared=function(a){var c=this;return this.data.card=null,this.data.owner=b.owner,b.owner.id===a?(this.render(),this.activateLink(".js-shared")):b.demo.active?b.owner.demo.fetch({success:function(){return c.render(),c.activateLink(".js-shared")}}):(b.owner.set("_id",a),b.owner.fetch({success:function(){return c.render(),c.activateLink(".js-shared")}})),this},f.prototype.sharedCard=function(){return this.data.card=b.sharedCard,b.owner.set(b.sharedCard.get("owner")),this.data.owner=b.owner,this.render(),this.activateLink(".js-shared-card"),this},f}(Backbone.View)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/card",[],function(){var a;return a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.idAttribute="_id",c.prototype.urlRoot="/api/cards",c.prototype.shortenLengths={name:30,address:50,city:30,notes:140},c.prototype.shorten=function(a){var b,c;return c=this.shortenLengths[a],b=this.get(a),c&&b?c<b.length?b.substr(0,c-3)+"...":b:void 0},c}(Backbone.Model)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/cards",["models/card"],function(a){var c;return c=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.model=a,d.prototype.url="/api/cards",d}(Backbone.Collection)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/cardsmall_view",["app"],function(b){var d;return d=function(b){function d(){return this.destroy=a(this.destroy,this),this.render=a(this.render,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.tagName="li",d.prototype.template=jade.templates.cardsmall,d.prototype.initialize=function(){return this.model.on("change",this.render),this.model.on("destroy",this.destroy)},d.prototype.render=function(){var a;return a={_id:this.model.id,name:this.model.shorten("name"),address:this.model.shorten("address"),city:this.model.shorten("city"),notes:this.model.shorten("notes")},this.$el.html(this.template(a)),this},d.prototype.destroy=function(){return this.$el.remove()},d}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/cards_view",["app","models/cards","views/cardsmall_view"],function(b,d,e){var f;return f=function(f){function g(){return this.showHideNoCards=a(this.showHideNoCards,this),this.addAll=a(this.addAll,this),this.addOne=a(this.addOne,this),g.__super__.constructor.apply(this,arguments)}return c(g,f),g.prototype.id="js-cards",g.prototype.template=jade.templates.cards,g.prototype.events={"click a.js-show":"routerFollow"},g.prototype.initialize=function(){var a,c,e;return c=!b.cards||b.cards.demo!=null&&!b.cards.demo.fetched,this.collection=b.cards=b.cards||new d,this.collection.on("reset",this.addAll),this.collection.on("add",this.addOne),this.collection.on("add",this.showHideNoCards),this.collection.on("remove",this.showHideNoCards),this.$el.html(this.template()),this.$list=this.$("#js-cardslist"),this.$noCards=this.$("#js-nocards"),c?b.demo.active?(e=b.notifications.newLoader(),this.collection.demo.fetch({complete:function(){return b.notifications.remove(e)}})):(a=$("#cards-json").remove().text(),a?this.collection.reset(JSON.parse(a)):(e=b.notifications.newLoader(),this.collection.fetch({complete:function(){return b.notifications.remove(e)}}))):this.addAll()},g.prototype.routerFollow=function(a){return b.router.follow(a)},g.prototype.addOne=function(a,b){var c;return c=(new e({model:a})).render().$el,b!=="append"?this.$list.prepend(c):this.$list.append(c)},g.prototype.addAll=function(){var a=this;return this.showHideNoCards(),this.$list.children().remove(),this.collection.each(function(b){return a.addOne(b,"append")})},g.prototype.showHideNoCards=function(){return this.collection.length?this.$noCards.hide():this.$noCards.show()},g.prototype.refresh=function(){var a;return b.demo.active?(a=b.notifications.newLoader(),this.collection.demo.fetch({complete:function(){return b.notifications.remove(a)}})):(a=b.notifications.newLoader(),this.collection.fetch({complete:function(){return b.notifications.remove(a)}}))},g}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/cardsnew_view",["app","models/cards"],function(b,d){var e;return e=function(e){function f(){return this.cancel=a(this.cancel,this),this.add=a(this.add,this),f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.id="js-cardsnew",f.prototype.template=jade.templates.cardsnew,f.prototype.events={"click .js-add":"add","click .js-cancel":"cancel"},f.prototype.initialize=function(){var a;return a=$("#cards-json").remove().text(),a&&(b.cards=b.cards||new d,b.cards.reset(JSON.parse(a))),this.render()},f.prototype.render=function(){return this.$el.html(this.template()),this},f.prototype.clearForm=function(){return this.$el.find("input[name='name']").val(""),this.$el.find("input[name='address']").val(""),this.$el.find("input[name='city']").val(""),this.$el.find("textarea[name='notes']").val("")},f.prototype.add=function(a){var c,e,f;return a.preventDefault(),c={name:this.$el.find("input[name='name']").val(),address:this.$el.find("input[name='address']").val(),city:this.$el.find("input[name='city']").val(),notes:this.$el.find("textarea[name='notes']").val()},this.clearForm(),e=!b.cards||b.cards.demo!=null&&!b.cards.demo.fetched,e?(b.cards=b.cards||new d,b.demo.active?(f=b.notifications.newLoader(),b.cards.demo.fetch({success:function(){if(b.demo.active)return b.cards.demo.create(c,{at:0})},complete:function(){return b.notifications.remove(f)}})):(f=b.notifications.newLoader(),b.cards.fetch({success:function(){return b.cards.create(c,{at:0})},complete:function(){return b.notifications.remove(f)}}))):b.demo.active?b.cards.demo.create(c,{at:0}):b.cards.create(c,{at:0}),b.router.navigate("cards",{trigger:!0}),$(window).scrollTop(0)},f.prototype.cancel=function(a){return a.preventDefault(),this.clearForm(),b.router.navigate("cards",{trigger:!0}),$(window).scrollTop(0)},f}(Backbone.View)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("views/cardsshare_view",["app"],function(a){var c;return c=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.id="js-cardsshare",d.prototype.template=jade.templates.cardsshare,d.prototype.initialize=function(){},d.prototype.render=function(){var b;return b=window.location.origin+"/shared/"+a.user.id,this.$el.html(this.template({link:b})),this},d}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/card_view",["app","models/card"],function(b,d){var e;return e=function(e){function f(){return this.render=a(this.render,this),f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.id="js-card",f.prototype.template=jade.templates.card,f.prototype.initialize=function(a){var c,e;this.model=b.card=b.card||new d,this.model.on("change",this.render);if(a===this.model.id)return this.render();e=$("#card-json").remove().text();if(e){c=JSON.parse(e);if(c.owner._id===b.user.id&&c._id===a)return this.model.set(c)}},f.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this},f.prototype.index=function(a){var c,d,e;return c=(e=b.cards)!=null?e.get(a):void 0,c?(c!==this.model&&(this.model.off("change",this.render),this.model=b.card=c,this.model.on("change",this.render),this.render()),b.dispatcher.trigger("card:ready")):a!==this.model.id?(this.model.set({_id:a},{silent:!0}),b.demo.active?(d=b.notifications.newLoader(),this.model.demo.fetch({complete:function(){return b.notifications.remove(d)},success:function(){return b.dispatcher.trigger("card:ready")}})):(d=b.notifications.newLoader(),this.model.fetch({complete:function(){return b.notifications.remove(d)},success:function(){return b.dispatcher.trigger("card:ready")}}))):b.dispatcher.trigger("card:ready"),$(window).scrollTop(0),this},f}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/cardedit_view",["app","models/card"],function(b,d){var e;return e=function(e){function f(){return this.cancel=a(this.cancel,this),this.save=a(this.save,this),this.render=a(this.render,this),f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.id="js-cardedit",f.prototype.template=jade.templates.cardedit,f.prototype.events={"click .js-save":"save","click .js-cancel":"cancel"},f.prototype.initialize=function(a){var c,e;this.model=b.card=b.card||new d,this.model.on("change",this.render);if(a===this.model.id)return this.render();e=$("#card-json").remove().text();if(e){c=JSON.parse(e);if(c.owner._id===b.user.id&&c._id===a)return this.model.set(c)}},f.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this},f.prototype.index=function(a){var c,d,e;return c=(e=b.cards)!=null?e.get(a):void 0,c?(c!==this.model&&(this.model.off("change",this.render),this.model=b.card=c,this.model.on("change",this.render),this.render()),b.dispatcher.trigger("card:edit:ready")):a!==this.model.id?(this.model.set({_id:a},{silent:!0}),b.demo.active?(d=b.notifications.newLoader(),this.model.demo.fetch({complete:function(){return b.notifications.remove(d)},success:function(){return b.dispatcher.trigger("card:edit:ready")}})):(d=b.notifications.newLoader(),this.model.fetch({complete:function(){return b.notifications.remove(d)},success:function(){return b.dispatcher.trigger("card:edit:ready")}}))):b.dispatcher.trigger("card:edit:ready"),$(window).scrollTop(0),this},f.prototype.save=function(a){return a.preventDefault(),b.demo.active?this.model.set({name:this.$("input[name='name']").val(),address:this.$("input[name='address']").val(),city:this.$("input[name='city']").val(),notes:this.$("textarea[name='notes']").val()}):this.model.save({name:this.$("input[name='name']").val(),address:this.$("input[name='address']").val(),city:this.$("input[name='city']").val(),notes:this.$("textarea[name='notes']").val()}),b.router.navigate("card/"+this.model.id,{trigger:!0})},f.prototype.cancel=function(a){return a.preventDefault(),this.render(),b.router.navigate("card/"+this.model.id,{trigger:!0})},f}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/cardshare_view",["app","models/card"],function(b,d){var e;return e=function(e){function f(){return this.render=a(this.render,this),f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.id="js-cardshare",f.prototype.template=jade.templates.cardshare,f.prototype.initialize=function(a){var c,e;this.model=b.card=b.card||new d,this.model.on("change",this.render);if(a===this.model.id)return this.render();e=$("#card-json").remove().text();if(e){c=JSON.parse(e);if(c.owner._id===b.user.id&&c._id===a)return this.model.set(c)}},f.prototype.render=function(){var a;return a=window.location.origin+"/shared/"+this.model.get("owner")._id,a+="/card/"+this.model.id,this.$el.html(this.template({name:this.model.get("name"),link:a})),this},f.prototype.index=function(a){var c,d,e;return c=(e=b.cards)!=null?e.get(a):void 0,c?(c!==this.model&&(this.model.off("change",this.render),this.model=b.card=c,this.model.on("change",this.render),this.render()),b.dispatcher.trigger("card:share:ready")):a!==this.model.id?(this.model.set({_id:a},{silent:!0}),b.demo.active?(d=b.notifications.newLoader(),this.model.demo.fetch({complete:function(){return b.notifications.remove(d)},success:function(){return b.dispatcher.trigger("card:share:ready")}})):(d=b.notifications.newLoader(),this.model.fetch({complete:function(){return b.notifications.remove(d)},success:function(){return b.dispatcher.trigger("card:share:ready")}}))):b.dispatcher.trigger("card:share:ready"),$(window).scrollTop(0),this},f}(Backbone.View)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/sharedcard",["models/card"],function(a){var c;return c=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.url=function(){return"/api/shared/"+this.get("owner")._id+"/cards/"+this.id},c}(a)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/sharedcards",["models/sharedcard","models/cards"],function(a,c){var d;return d=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.model=a,d.prototype.shareId=null,d.prototype.url=function(){return"/api/shared/"+this.shareId+"/cards"},d}(c)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/sharedcardsmall_view",["app"],function(b){var d;return d=function(b){function d(){return this.render=a(this.render,this),d.__super__.constructor.apply(this,arguments)}return c(d,b),d.prototype.tagName="li",d.prototype.template=jade.templates.sharedcardsmall,d.prototype.render=function(){var a;return a={_id:this.model.id,name:this.model.shorten("name"),address:this.model.shorten("address"),city:this.model.shorten("city"),notes:this.model.shorten("notes"),owner:this.model.get("owner")},this.$el.html(this.template(a)),this},d}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/sharedcards_view",["app","models/sharedcards","views/sharedcardsmall_view"],function(b,d,e){var f;return f=function(f){function g(){return this.showHideNoCards=a(this.showHideNoCards,this),this.addAll=a(this.addAll,this),this.addOne=a(this.addOne,this),g.__super__.constructor.apply(this,arguments)}return c(g,f),g.prototype.id="js-sharedcards",g.prototype.template=jade.templates.sharedcards,g.prototype.events={"click a.js-show":"routerFollow"},g.prototype.shareId=null,g.prototype.initialize=function(a){var c;this.collection=b.sharedCards=b.sharedCards||new d,this.collection.on("reset",this.addAll),this.$el.html(this.template()),this.$list=this.$("#js-cardslist"),this.$noCards=this.$("#js-nocards"),c=$("#sharedcards-json").remove().text();if(c)return this.shareId=a,this.collection.reset(JSON.parse(c))},g.prototype.routerFollow=function(a){return b.router.follow(a)},g.prototype.addOne=function(a,b){var c;return c=(new e({model:a})).render().$el,b!=="append"?this.$list.prepend(c):this.$list.append(c)},g.prototype.addAll=function(){var a=this;return this.showHideNoCards(),this.$list.children().remove(),this.collection.each(function(b){return a.addOne(b,"append")})},g.prototype.showHideNoCards=function(){return this.collection.length?this.$noCards.hide():this.$noCards.show()},g.prototype.refresh=function(){var a;return b.demo.active?(a=b.notifications.newLoader(),this.collection.demo.fetch({complete:function(){return b.notifications.remove(a)}})):(this.collection.shareId=this.shareId,a=b.notifications.newLoader(),this.collection.fetch({complete:function(){return b.notifications.remove(a)}}))},g.prototype.index=function(a){return this.shareId!==a&&(this.shareId=a,this.refresh()),this},g}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/sharedcard_view",["app","models/sharedcard"],function(b,d){var e;return e=function(e){function f(){return this.render=a(this.render,this),f.__super__.constructor.apply(this,arguments)}return c(f,e),f.prototype.id="js-sharedcard",f.prototype.template=jade.templates.card,f.prototype.initialize=function(){var a;this.model=b.sharedCard=b.sharedCard||new d,this.model.on("change",this.render),a=$("#sharedcard-json").remove().text();if(a)return this.model.set(JSON.parse(a))},f.prototype.render=function(){return this.$el.html(this.template(this.model.toJSON())),this},f.prototype.index=function(a,c){var d,e,f;return d=(f=b.sharedCards)!=null?f.get(c):void 0,d?(d!==this.model&&(this.model.off("change",this.render),this.model=b.sharedCard=d,this.model.on("change",this.render),this.render()),b.dispatcher.trigger("shared:card:ready")):c!==this.model.id?(this.model.set({id:c,owner:{_id:a}},{silent:!0}),b.demo.active?(e=b.notifications.newLoader(),this.model.demo.fetch({complete:function(){return b.notifications.remove(e)},success:function(){return b.dispatcher.trigger("shared:card:ready")}})):(e=b.notifications.newLoader(),this.model.fetch({complete:function(){return b.notifications.remove(e)},success:function(){return b.dispatcher.trigger("shared:card:ready")}}))):b.dispatcher.trigger("shared:card:ready"),$(window).scrollTop(0),this},f}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("router",["app","views/subnavcards_view","views/cards_view","views/cardsnew_view","views/cardsshare_view","views/card_view","views/cardedit_view","views/cardshare_view","views/sharedcards_view","views/sharedcard_view"],function(b,d,e,f,g,h,i,j,k,l){var m;return m=function(m){function n(){return this.follow=a(this.follow,this),n.__super__.constructor.apply(this,arguments)}return c(n,m),n.prototype.routes={"":"index",demo:"cards",cards:"cards","cards/new":"cardsNew","cards/share":"cardsShare","card/:id":"card","card/:id/edit":"cardEdit","card/:id/share":"cardShare","shared/:shareId":"shared","shared/:shareId/card/:cardId":"sharedCard"},n.prototype.initialize=function(){},n.prototype.follow=function(a){var b,c;return a.preventDefault(),b=$(a.currentTarget),c=b.attr("href").replace(Backbone.history.routeStripper,""),this.navigate(c,{trigger:!0})},n.prototype.index=function(){return this.cards()},n.prototype.cards=function(){return b.subnavCardsView=b.subnavCardsView||new d,b.cardsView=b.cardsView||new e,b.navigationView.cards(),b.subnavView.show(b.subnavCardsView.cards()),b.contentView.show(b.cardsView)},n.prototype.cardsNew=function(){return b.subnavCardsView=b.subnavCardsView||new d,b.cardsNewView=b.cardsNewView||new f,b.navigationView.cards(),b.subnavView.show(b.subnavCardsView["new"]()),b.contentView.show(b.cardsNewView)},n.prototype.cardsShare=function(){return b.subnavCardsView=b.subnavCardsView||new d,b.cardsShareView=b.cardsShareView||new g,b.navigationView.cards(),b.subnavView.show(b.subnavCardsView.share()),b.contentView.show(b.cardsShareView.render())},n.prototype.card=function(a){return b.subnavCardsView=b.subnavCardsView||new d,b.cardView=b.cardView||new h(a),b.navigationView.cards(),b.subnavView.show(b.subnavCardsView),b.contentView.show(b.cardView.index(a))},n.prototype.cardEdit=function(a){return b.subnavCardsView=b.subnavCardsView||new d,b.cardEditView=b.cardEditView||new i(a),b.navigationView.cards(),b.subnavView.show(b.subnavCardsView),b.contentView.show(b.cardEditView.index(a))},n.prototype.cardShare=function(a){return b.subnavCardsView=b.subnavCardsView||new d,b.cardShareView=b.cardShareView||new j(a),b.navigationView.cards(),b.subnavView.show(b.subnavCardsView),b.contentView.show(b.cardShareView.index(a))},n.prototype.shared=function(a){return b.subnavCardsView=b.subnavCardsView||new d,b.sharedCardsView=b.sharedCardsView||new k(a),b.navigationView.cards(),b.subnavView.show(b.subnavCardsView.shared(a)),b.contentView.show(b.sharedCardsView.index(a))},n.prototype.sharedCard=function(a,c){return b.subnavCardsView=b.subnavCardsView||new d,b.sharedCardView=b.sharedCardView||new l,b.navigationView.cards(),b.subnavView.show(b.subnavCardsView),b.contentView.show(b.sharedCardView.index(a,c))},n}(Backbone.Router)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/user",[],function(){var a;return a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.idAttribute="_id",c}(Backbone.Model)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("models/notification",[],function(){var a;return a=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.defaults={message:"Empty notification",timeout:2e3,type:""},c}(Backbone.Model)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("models/notifications",["models/notification"],function(b){var d;return d=function(d){function e(){return this.current=a(this.current,this),this.newLoader=a(this.newLoader,this),this["new"]=a(this["new"],this),e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.model=b,e.prototype.error=!1,e.prototype["new"]=function(a){var c,d,e=this;return this.error?null:(c=new b(a),this.add(c,{at:0}),d=c.get("timeout"),d&&setTimeout(function(){return e.remove(c)},d),c)},e.prototype.newLoader=function(){return this["new"]({message:"Loading",timeout:!1})},e.prototype.current=function(){return this.at(0)},e}(Backbone.Collection)})}.call(this),function(){define("session",["app","models/user","models/notifications"],function(a,b,c){var d;return d=function(){function d(d){a.user=new b,a.notifications=new c}return _(d.prototype).defaults(Backbone.Events),d.prototype.authenticated=!1,d.prototype.load=function(){var b;b=$("#user-json").remove().text();if(b)return b==="demo"?(a.demo.load(),a.user.demo.load(),this.authenticated=!0):(a.user.set(JSON.parse(b)),this.authenticated=!0)},d}()})}.call(this),function(){define("dispatcher",[],function(){var a;return a=function(){function a(){}return _(a.prototype).defaults(Backbone.Events),a}()})}.call(this),function(){define("demo",["app","models/user","models/cards","models/card","models/owner","models/sharedcards","models/sharedcard"],function(a,b,c,d,e,f,g){var h;return h=function(){function h(){this.active&&this.load()}return h.prototype.active=!1,h.prototype.responseDelay=0,h.prototype.load=function(){var h,i,j=this;return a.user=a.user||new b,a.cards=a.cards||new c,a.card=a.card||new d,a.sharedCards=a.sharedCards||new f,a.sharedCard=a.sharedCard||new g,a.owner=a.owner||new e,a.user.demo={},a.cards.demo={},a.card.demo={},a.sharedCards.demo={},a.sharedCard.demo={},a.owner.demo={},i={_id:"1",name:"Don Draper",email:"dondraper@example.com"},h=[{_id:"1",name:"The Dead Poet",address:"450 Amsterdam Ave (& 81st St)",city:"New York",notes:"Irish pub, small room, good beer selection, music jukebox",owner:{_id:"1",name:"Don Draper"}},{_id:"2",name:"Solas",address:"232 E 9th Street (& 2nd Ave)",city:"New York",notes:"Dancing bar, mainstream music, large room, usually not a long line to get in",owner:{_id:"1",name:"Don Draper"}},{_id:"3",name:"Sweet Leaf",address:"10-93 Jackson Avenue (& 49th Ave), Long Island City",city:"New York",notes:"Great little coffee shop in Long Island City, very good coffee, nice decor with leather seats & vinyl records",owner:{_id:"1",name:"Don Draper"}},{_id:"4",name:"Cloister Cafe",address:"238 East 9th Street (& 2nd Ave)",city:"New York",notes:"Hookah bar, nice decor & outside seating, great hookah, decent food too",owner:{_id:"1",name:"Don Draper"}},{_id:"5",name:"The 55 Bar",address:"55 Christopher Street (& 7th Ave)",city:"New York",notes:"Small jazz bar, 2 shows usually 7pm & 10pm, arrive early, good atmosphere",owner:{_id:"1",name:"Don Draper"}},{_id:"6",name:"Piccolo Cafe",address:"238 Madison Ave (& 37th St)",city:"New York",notes:"Small italian, great for lunch, good pasta & sandwiches, not expensive",owner:{_id:"1",name:"Don Draper"}},{_id:"7",name:"Dominie's Hoek",address:"48-17 Vernon Boulevard (& 49th Ave), Long Island City",city:"New York",notes:"Bar, outdoor sitting area, cheaper than Manhattan bars, kitchen with your usual bar food",owner:{_id:"1",name:"Don Draper"}},{_id:"8",name:"230 Fifth",address:"230 5th Ave (& 27th St)",city:"New York",notes:"Rooftop bar, amazing view of Empire State, a little expensive, arrive early for a good seat",owner:{_id:"1",name:"Don Draper"}}],a.user.demo.load=function(){return a.user.set(i)},a.cards.demo.fetch=function(b){var c,d,e,f;return a.cards.demo.fetched=!0,f=!1,b=b?b:{},e=b.success,d=b.error,c=b.complete,setTimeout(function(){return f?($("body").trigger("ajaxError"),d&&d(),c&&c(),!1):(a.cards.reset(h),$("body").trigger("ajaxSuccess"),e&&e(),c&&c(),!0)},j.responseDelay)},a.cards.demo.create=function(b,c){var d,e,f,g,h,i;return i=!1,c=c?c:{},h=c.success,f=c.error,e=c.complete,g=c.silent?c.silent:!1,d=c.at,b._id=(parseInt(_.max(a.cards.models,function(a){return a.id}).id)+1).toString(),a.cards.add(b,{at:d,silent:g}),setTimeout(function(){return i?($("body").trigger("ajaxError"),f&&f(),e&&e(),!1):($("body").trigger("ajaxSuccess"),h&&h(),e&&e(),!0)}),j.responseDelay},a.card.demo.fetch=function(b){var c,d,e,f,g;return a.card.demo.fetched=!0,e=a.card.id,g=!1,b=b?b:{},f=b.success,d=b.error,c=b.complete,setTimeout(function(){return g?($("body").trigger("ajaxError"),d&&d(),c&&c(),!1):(a.card.set(_.filter(h,function(a){return a.id===e})[0]),$("body").trigger("ajaxSuccess"),f&&f(),c&&c(),!0)},j.responseDelay)},a.sharedCards.demo.fetch=function(b){var c,d,e,f;return f=!1,b=b?b:{},e=b.success,d=b.error,c=b.complete,setTimeout(function(){return f?($("body").trigger("ajaxError"),d&&d(),c&&c(),!1):(a.sharedCards.reset(h),$("body").trigger("ajaxSuccess"),e&&e(),c&&c(),!0)},j.responseDelay)},a.sharedCard.demo.fetch=function(b){var c,d,e,f,g;return a.sharedCard.demo.fetched=!0,e=a.sharedCard.id,g=!1,b=b?b:{},f=b.success,d=b.error,c=b.complete,setTimeout(function(){return g?($("body").trigger("ajaxError"),d&&d(),c&&c(),!1):(a.sharedCard.set(_.filter(h,function(a){return a.id===e})[0]),$("body").trigger("ajaxSuccess"),f&&f(),c&&c(),!0)},j.responseDelay)},a.owner.demo.fetch=function(b){var c,d,e,f;return f=!1,b=b?b:{},e=b.success,d=b.error,c=b.complete,setTimeout(function(){return f?($("body").trigger("ajaxError"),d&&d(),c&&c(),!1):(a.owner.set(i),$("body").trigger("ajaxSuccess"),e&&e(),c&&c(),!0)},j.responseDelay/2)},this.active=!0},h.prototype.destroy=function(a,b){return a.trigger("destroy",a,a.collection,b)},h.prototype.unload=function(){return a.user.demo=
null,a.cards.demo=null,a.card.demo=null,a.sharedCards.demo=null,a.sharedCard.demo=null,a.owner.demo=null,this.active=!1},h}()})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("views/navigation_view",["app"],function(a){var c;return c=function(c){function d(){return d.__super__.constructor.apply(this,arguments)}return b(d,c),d.prototype.id="js-navigation",d.prototype.template=jade.templates.navigation,d.prototype.events={"click .js-cards a":"routerFollow"},d.prototype.initialize=function(){return this.render()},d.prototype.render=function(){var b;return b={},b.authenticated=a.session.authenticated,b.user=a.user.toJSON(),this.$el.html(this.template(b)),this},d.prototype.routerFollow=function(b){return a.router.follow(b)},d.prototype.cards=function(){return this.$(".js-cards").addClass("active")},d}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/notifications_view",["app"],function(b){var d;return d=function(d){function e(){return this.error=a(this.error,this),this.render=a(this.render,this),e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.id="js-notifications",e.prototype.template=jade.templates.notifications,e.prototype.initialize=function(){return this.collection=b.notifications,this.collection.on("add remove",this.render),$("body").ajaxError(this.error)},e.prototype.render=function(){var a,b;return a=(b=this.collection.current())!=null?b.toJSON():void 0,this.$el.html(this.template({notification:a})),this},e.prototype.error=function(a,b){var c;return(b!=null?b.status:void 0)===404?router.navigate("",{trigger:!0}):(c="<strong>Oops!</strong> An error occured. It's not your fault, it's ours. Please try refreshing the page. <a href='"+window.location+"'>Refresh</a>",this.collection["new"]({message:c,timeout:!1,type:"notification-error"}),this.collection.error=!0)},e}(Backbone.View)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("views/subnav_view",["app"],function(a){var c;return c=function(a){function c(){return c.__super__.constructor.apply(this,arguments)}return b(c,a),c.prototype.id="js-subnav",c.prototype.currentView=null,c.prototype.initialize=function(){},c.prototype.show=function(a){return a!==this.currentView&&(this.close(),a.delegateEvents(),this.$el.html(a.$el),this.currentView=a),this},c.prototype.close=function(){return this.currentView&&(this.currentView.undelegateEvents(),this.currentView.remove(),this.currentView=null),this},c}(Backbone.View)})}.call(this),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}},b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a};define("views/content_view",["app"],function(b){var d;return d=function(d){function e(){return this.refresh=a(this.refresh,this),e.__super__.constructor.apply(this,arguments)}return c(e,d),e.prototype.id="js-content",e.prototype.currentView=null,e.prototype.initialize=function(){return b.dispatcher.on("content:refresh",this.refresh)},e.prototype.show=function(a){return a!==this.currentView&&(this.close(),a.delegateEvents(),this.$el.html(a.$el),this.currentView=a),this},e.prototype.close=function(){return this.currentView&&(this.currentView.undelegateEvents(),this.currentView.remove(),this.currentView=null),this},e.prototype.refresh=function(){var a;if((a=this.currentView)!=null?a.refresh:void 0)return this.currentView.refresh()},e}(Backbone.View)})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function e(){this.constructor=b}for(var d in c)a.call(c,d)&&(b[d]=c[d]);return e.prototype=c.prototype,b.prototype=new e,b.__super__=c.prototype,b};define("views/application_view",["app","views/navigation_view","views/notifications_view","views/subnav_view","views/content_view"],function(a,c,d,e,f){var g;return g=function(g){function h(){return h.__super__.constructor.apply(this,arguments)}return b(h,g),h.prototype.id="js-application",h.prototype.initialize=function(){return a.navigationView=new c,a.notificationsView=new d,a.subnavView=new e,a.contentView=new f,this.$el.append(a.navigationView.$el),this.$el.append(a.notificationsView.$el),this.$el.append(a.subnavView.$el),this.$el.append(a.contentView.$el)},h}(Backbone.View)})}.call(this),function(){require.config({baseUrl:"/js/"}),require(["app","router","session","dispatcher","demo","views/application_view"],function(a,b,c,d,e,f){var g=this;return a.router=new b,a.session=new c,a.dispatcher=new d,a.demo=new e,$(function(){return a.session.load(),a.applicationView=new f,$("body").prepend(a.applicationView.$el),Backbone.history.start({pushState:!0})})})}.call(this),define("main",function(){});